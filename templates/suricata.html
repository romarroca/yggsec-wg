{% extends "base.html" %}
{% block title %}YggSec · IPS Events{% endblock %}

{% block head_extra %}
<style>
  .section-title{margin-bottom:.5rem}
  .monitor-table thead th{background:var(--card-muted);color:var(--ink)}
  body.theme-dark .monitor-table thead th{background:#2b333a!important;color:#e9eef3!important;border-bottom-color:#2d3942!important}
  body.theme-dark .monitor-table td, body.theme-dark .monitor-table th{color:var(--ink)!important}
  body.theme-dark .monitor-table tbody td{border-top-color:#2d3942!important}
  body.theme-dark .monitor-table tbody tr:nth-of-type(odd) td{background:#1e252b!important}
  body.theme-dark .monitor-table tbody tr:nth-of-type(even) td{background:#20272e!important}
  body.theme-dark .monitor-table tbody tr:hover td{background:#263038!important}
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <h2 class="mb-0 section-title">Suricata Events</h2>
  <div class="d-flex align-items-center gap-2">
    <select id="rows-select" class="form-select form-select-sm w-auto">
      <option value="100">Last 100</option>
      <option value="200" selected>Last 200</option>
      <option value="500">Last 500</option>
      <option value="1000">Last 1000</option>
    </select>
    <button id="refresh-btn" class="btn btn-sm">Refresh Now</button>
    <button id="auto-btn" class="btn btn-sm btn-outline-secondary">Auto Refresh: Off</button>
    <button id="clear-btn" class="btn btn-sm btn-outline-danger">Clear Logs</button>
  </div>
</div>

<!-- Suricata Status Panel (Monitoring Only) -->
<div class="card mb-3">
  <div class="card-header fw-bold d-flex justify-content-between align-items-center">
    <span>Suricata IPS Status</span>
    <small class="text-muted">
      IPS Status: <span id="suri-status" class="badge bg-secondary">Loading...</span>
    </small>
  </div>
  <div class="card-body">
    <!-- Hidden form for CSRF token -->
    <form id="clear-form" class="d-none">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    </form>
    
    <div class="d-flex gap-2 align-items-center">
      <div class="d-flex align-items-center">
        <span class="fw-bold me-2">IPS Protection:</span>
        <span id="ips-mode" class="badge bg-secondary">Loading...</span>
      </div>
      <div class="vr"></div>
      <small class="text-muted">
        To control Suricata: SSH → <code>sudo systemctl start/stop suricata</code>
      </small>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header fw-bold">Suricata alerts (eve.json)</div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-sm table-striped table-hover monitor-table">
        <thead>
          <tr>
            <th class="min-w-160">Time</th>
            <th>Signature</th>
            <th>Category</th>
            <th class="text-end">Sev</th>
            <th>Proto</th>
            <th>Src</th>
            <th>Dst</th>
          </tr>
        </thead>
        <tbody id="tbl-suri">
          <tr><td colspan="7" class="text-muted">Loading…</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script nonce="{{ g.nonce }}" src="{{ url_for('static', filename='js/suricata.js') }}"></script>
{% endblock %}

